function displayCertMeanings(){$("#showCertDescription")[0].checked?$("#certDescriptionBox").slideDown("slow"):$("#certDescriptionBox").slideUp("slow",function(){$("#certDescriptionBox").text("Hover over a certification to show its meaning")})}function showCertMeaning(){let certCheckBox=$("#showCertDescription")[0],certNumber=this.dataset.certnumber,cert=this.dataset.certvalue;certCheckBox.checked&&$("#certDescriptionBox").text(cert+" - "+certDesc[certNumber])}function selectCert(){let lesserCerts=$("#includeLesserCerts")[0],higherCerts=$("#includeHigherCerts")[0];certURL=`&certification_country=GB&certification`,lesserCerts.checked&&!higherCerts.checked?certURL+=`.lte=${this.dataset.certvalue}`:!lesserCerts.checked&&higherCerts.checked?certURL+=`.gte=${this.dataset.certvalue}`:certURL+=`=${this.dataset.certvalue}`,Array.from(document.getElementsByClassName("cert")).forEach(function(ele){ele.classList.remove("active")}),this.classList.add("active")}function selectGenre(){$(this).toggleClass("active")}function getReleaseYear(year){let yearsBefore=$("#yearsBefore")[0],yearsAfter=$("#yearsAfter")[0];return year&&yearsBefore.checked&&!yearsAfter.checked?`&primary_release_date.lte=${year}-12-31`:year&&yearsAfter.checked&&!yearsBefore.checked?`&primary_release_date.gte=${year}-01-01`:year?`&primary_release_year=${year}`:""}function searchForFilms(){$(".results").empty();let selectedGenres=$(".genre.active"),genreURL="";if(selectedGenres.length>=1){genreURL=`&with_genres=${selectedGenres[0].dataset.genreid}`;for(let k=1;k<selectedGenres.length;k++)genreURL+=`,${selectedGenres[k].dataset.genreid}`}let yearURL=getReleaseYear($("#releaseYearInput").val()),searchURL=baseURL+certURL+genreURL+yearURL;$.getJSON(searchURL,function(data){let movieResults=data.results;0===data.results.length?$(".results").append(`<div>No results match your search</div>`):movieResults.map(ele=>{$(".results").append(`\n          <div class="result" data-film_id="${ele.id}">\n            <div>\n              <img src="https://image.tmdb.org/t/p/w342/${ele.poster_path}">\n              <h4 class="film-title">${ele.title}</h4>\n            </div>\n          </div>`)})}),certURL="",$(".results").on("click",".result",showMovie),$("body").on("click",".close",function(){$("#movieModal").hide()}),$(".searchContainer").slideUp("slow"),$("#newSearch").hasClass("hidden")&&$("#newSearch").slideDown("slow")}function showMovie(e){$("#movieModal").remove();let filmURL=`https://api.themoviedb.org/3/movie/${e.currentTarget.dataset.film_id}?api_key=${mmbjdb}&language=en-US`;$.getJSON(filmURL,function(data){let year=data.release_date.match(/^\d+/g),production_co=0!==data.production_companies.length?data.production_companies[0].name:"",homepage=""!=data.homepage?'<a class="movie-link" href="'+data.homepage+'" target="_blank">Homepage</a>':"";$("body").append(`\n    <div id="movieModal">  \n      <div class="modal-content">                 \n        <div class="movie-headlines">\n          <span class="close">x</span>\n          <div><img src="https://image.tmdb.org/t/p/w92/${data.poster_path}"></div>\n          <div class="modalText">\n            <h3 id="modal-heading">${data.original_title}</h3>\n            <p>${data.tagline}</p>\n            <p id="modal-year"><em>${year}</em></p>                      \n          </div>                     \n        </div>\n        <p id="modal-description">${data.overview}</p>  \n        <div class="movie-details">\n          <p>${production_co}</p>\n          ${homepage}         \n        </div>\n      </div>          \n    </div>`),$("#movieModal").show()})}function reset(){$(".active").each(function(){$(this).removeClass("active")}),$("#releaseYearInput").val(""),$("#yearsBefore").prop("checked",!1),$("#yearsAfter").prop("checked",!1),$("#includeLesserCerts").prop("checked",!1),$("#includeHigherCerts").prop("checked",!1),$(".results").empty(),certURL=""}const mmbjdb=`019825fa58fb7940e7912b45ae59d036`;let GBCerts=[],certEles=[],certDesc=[];const baseURL=`https://api.themoviedb.org/3/discover/movie?sort_by=popularity.desc&api_key=${mmbjdb}&language=en-US&region=GB`;let certURL="";$(document).ready(function(){certPromise.then(function(){certEles=document.getElementsByClassName("cert");for(let j=0;j<certEles.length;j++)certEles[j].addEventListener("mouseover",showCertMeaning),certEles[j].addEventListener("click",selectCert)},function(error){console.error(`Error: ${error}`)}),genrePromise.then(function(){let genreElements=document.getElementsByClassName("genre");for(let j=0;j<genreElements.length;j++)genreElements[j].addEventListener("click",selectGenre)},function(error){console.error(`Genre: ${error}`)}),$("#showCertDescription")[0].addEventListener("click",displayCertMeanings),$("#searchButton").click(searchForFilms),$("#resetButton").click(reset),$(".result").on("click",showMovie),$("#newSearch").on("click",function(){$(".searchContainer").slideDown("slow"),reset(),$("#newSearch").slideUp("slow")})});let certPromise=new Promise(function(resolve,reject){$.getJSON(`https://api.themoviedb.org/3/certification/movie/list?api_key=${mmbjdb}`,function(data){let certs=data.certifications.GB;for(let i=1;i<=certs.length;i++){let x=certs.filter(obj=>obj.order==i);GBCerts.push(...x)}GBCerts.map((ele,idx)=>{$("#certSelect").append(`\n        <div class='cert' data-certValue='${ele.certification}' data-certNumber='${idx}'>${ele.certification}\n        </div>`),certDesc.push(ele.meaning)})}),0==certEles.length?resolve("Yay"):reject("Boo")}),genrePromise=new Promise(function(resolve,reject){$.getJSON(`https://api.themoviedb.org/3/genre/movie/list?api_key=${mmbjdb}&language=en-US`,function(data){data.genres.map(ele=>{$("#genreSelect").append(`<div class='genre' data-genreId='${ele.id}'>${ele.name}</div>`)})}),resolve("Yay")});